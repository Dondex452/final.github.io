{% extends "layout.html" %}
{% block admit_form %}
<div class="dashboard-content-one">
    <!-- Breadcrumbs Area Start Here -->
    <div class="breadcrumbs-area">
        <h3>Transcript</h3>
        <ul>
            <li>
                <a href="#">Home</a>
            </li>
            <li>Student Transcript Upload</li>
        </ul>
    </div>
    <!-- Breadcrumbs Area End Here -->
    <!-- Transcript Upload Area Start Here -->
    <div class="card height-auto">
        <div class="card-body">
            <div class="heading-layout1">
                <div class="item-title">
                    <h3>Upload Transcript</h3>
                </div>
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-expanded="false">...</a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="#"><i class="fas fa-times text-orange-red"></i>Close</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-cogs text-dark-pastel-green"></i>Download</a>
                        <a class="dropdown-item" href="#"><i class="fas fa-redo-alt text-orange-peel"></i>Refresh</a>
                    </div>
                </div>
            </div>
            <form id="uploadForm" action="{{ url_for('upload_transcript') }}" method="post" enctype="multipart/form-data">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-12 form-group">
                        <label for="file-upload" class="dragndrop">
                            <i class="fas fa-cloud-upload-alt fa-3x"></i>
                            <p>Drag & Drop files here or <span class="browse">Browse</span></p>
                        </label>
                        <input type="file" id="file-upload" class="form-control-file" name="transcript_file" onchange="previewFile()">
                        <div id="file-preview-container"></div>
                    </div>
                    <div class="col-lg-6 col-12 form-group">
                        <label for="registration-number">Registration Number *</label>
                        <input type="text" id="registration-number" class="form-control" name="registration_number" placeholder="Enter Registration Number" required>
                    </div>
                    <div class="col-lg-6 col-12 form-group">
                        <label for="admin-password">Admin Password *</label>
                        <input type="password" id="admin-password" class="form-control" name="admin_password" placeholder="Enter Admin Password" required>
                    </div>
                    <div class="col-12 form-group">
                        <button type="submit" class="btn-fill-lg btn-gradient-yellow btn-hover-bluedark">Upload</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Transcript Upload Area End Here -->
    <!-- Download Transcript Area Start Here -->
    <div class="card height-auto">
        <div class="card-body">
            <form action="{{ url_for('handle_download_transcript') }}" method="post">
                <div class="row">
                    <div class="col-lg-6 col-12 form-group">
                        <label for="registration-number-download">Registration Number *</label>
                        <input type="text" id="registration-number-download" class="form-control" name="registration_number" placeholder="Enter Registration Number" required>
                    </div>
                    <div class="col-lg-6 col-12 form-group">
                        <label for="admin-password-download">Admin Password *</label>
                        <input type="password" id="admin-password-download" class="form-control" name="admin_password" placeholder="Enter Admin Password" required>
                    </div>
                    <div class="col-12 form-group">
                        <button type="submit" class="btn-fill-lg bg-blue-dark btn-hover-yellow">Download</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Download Transcript Area End Here -->
    <footer class="footer-wrap-layout1">
        <div class="copyright">Â© Copyrights <a href="#">akkhor</a> 2019. All rights reserved. Designed by <a href="#">PsdBosS</a></div>
    </footer>
</div>

<style>
    .dragndrop {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 2px dashed #ccc;
        padding: 40px;
        text-align: center;
        border-radius: 10px;
        background-color: #f9f9f9;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .dragndrop:hover {
        background-color: #f1f1f1;
    }
    .dragndrop i {
        color: #666;
        margin-bottom: 10px;
    }
    .dragndrop p {
        margin: 0;
        font-size: 18px;
        color: #666;
    }
    .dragndrop .browse {
        color: #007bff;
        text-decoration: underline;
    }
    #file-preview-container {
        margin-top: 10px;
    }
</style>

<script>
    function previewFile() {
        const preview = document.getElementById('file-preview-container');
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();

        reader.onloadend = function () {
            preview.innerHTML = ''; // Clear previous preview
            const fileType = getFileType(file.name);

            if (fileType === 'pdf') {
                preview.innerHTML = `<embed src="${reader.result}" width="100%" height="500px" type="application/pdf">`;
            } else if (fileType === 'docx' || fileType === 'doc' || fileType === 'xlsx' || fileType === 'xls') {
                const fileURL = URL.createObjectURL(file);
                preview.innerHTML = `<iframe src="https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(fileURL)}" width="100%" height="500px" frameborder="0"></iframe>`;
            } else {
                preview.innerHTML = `<p>Preview not available for this file type.</p>`;
            }
        }

        if (file) {
            reader.readAsDataURL(file);
        }
    }

    function getFileType(filename) {
        return filename.split('.').pop().toLowerCase();
    }
</script>

{% endblock admit_form %}
